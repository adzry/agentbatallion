<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Battalion - AI App Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .chat-message {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .progress-bar {
      transition: width 0.3s ease;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  <div class="container mx-auto max-w-4xl px-4 py-8">
    <!-- Header -->
    <div class="mb-8 text-center">
      <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
        Agent Battalion
      </h1>
      <p class="text-gray-400">AI-Powered Full-Stack App Generator</p>
    </div>

    <!-- Chat Interface -->
    <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700 mb-6">
      <!-- Messages Area -->
      <div id="messages" class="h-96 overflow-y-auto p-6 space-y-4">
        <div class="chat-message flex items-start space-x-3">
          <div class="flex-shrink-0 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
            <span class="text-sm font-bold">AB</span>
          </div>
          <div class="flex-1">
            <p class="text-gray-300">
              ðŸ‘‹ Welcome! Describe the app you want to generate, and I'll create a Next.js 15 application for you.
            </p>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div id="progress-container" class="hidden px-6 pb-4">
        <div class="flex items-center justify-between mb-2">
          <span id="progress-message" class="text-sm text-gray-400"></span>
          <span id="progress-percent" class="text-sm text-gray-400">0%</span>
        </div>
        <div class="w-full bg-gray-700 rounded-full h-2">
          <div id="progress-bar" class="progress-bar bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full" style="width: 0%"></div>
        </div>
      </div>

      <!-- Input Area -->
      <div class="border-t border-gray-700 p-4">
        <div class="flex space-x-2">
          <input
            type="text"
            id="specification-input"
            placeholder="e.g., Create a todo app with dark mode..."
            class="flex-1 bg-gray-700 text-gray-100 px-4 py-3 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            onkeypress="if(event.key === 'Enter') generateApp()"
          />
          <button
            onclick="generateApp()"
            id="generate-btn"
            class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold px-6 py-3 rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Generate App
          </button>
        </div>
      </div>
    </div>

    <!-- Generated Files Display -->
    <div id="files-container" class="hidden bg-gray-800 rounded-lg shadow-xl border border-gray-700 p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">Generated Files</h2>
        <button
          onclick="downloadCode()"
          class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg transition-colors"
        >
          ðŸ“¥ Download Source Code
        </button>
      </div>
      <div id="files-list" class="space-y-2 max-h-96 overflow-y-auto"></div>
    </div>
  </div>

  <script>
    const socket = io('http://localhost:4000');
    let generatedFiles = {};

    socket.on('connect', () => {
      console.log('Connected to server');
      addMessage('system', 'Connected to Agent Battalion server');
    });

    socket.on('disconnect', () => {
      addMessage('system', 'Disconnected from server');
    });

    socket.on('progress', (data) => {
      showProgress(data.message, data.progress);
    });

    socket.on('complete', (data) => {
      hideProgress();
      generatedFiles = data.files;
      displayFiles(data.files);
      addMessage('assistant', data.message || 'App generated successfully!');
      document.getElementById('generate-btn').disabled = false;
    });

    function addMessage(role, content) {
      const messagesDiv = document.getElementById('messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'chat-message flex items-start space-x-3';
      
      const iconDiv = document.createElement('div');
      iconDiv.className = role === 'user' 
        ? 'flex-shrink-0 w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center'
        : 'flex-shrink-0 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center';
      iconDiv.innerHTML = `<span class="text-sm font-bold">${role === 'user' ? 'U' : 'AB'}</span>`;
      
      const contentDiv = document.createElement('div');
      contentDiv.className = 'flex-1';
      contentDiv.innerHTML = `<p class="text-gray-300">${escapeHtml(content)}</p>`;
      
      messageDiv.appendChild(iconDiv);
      messageDiv.appendChild(contentDiv);
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function showProgress(message, progress) {
      const container = document.getElementById('progress-container');
      const messageEl = document.getElementById('progress-message');
      const percentEl = document.getElementById('progress-percent');
      const barEl = document.getElementById('progress-bar');
      
      container.classList.remove('hidden');
      messageEl.textContent = message;
      percentEl.textContent = `${progress}%`;
      barEl.style.width = `${progress}%`;
    }

    function hideProgress() {
      document.getElementById('progress-container').classList.add('hidden');
    }

    function generateApp() {
      const input = document.getElementById('specification-input');
      const specification = input.value.trim();
      
      if (!specification) {
        alert('Please enter an app specification');
        return;
      }

      // Reset UI
      generatedFiles = {};
      document.getElementById('files-container').classList.add('hidden');
      document.getElementById('generate-btn').disabled = true;
      
      addMessage('user', specification);
      input.value = '';
      
      socket.emit('generate-app', { specification });
    }

    function displayFiles(files) {
      const container = document.getElementById('files-container');
      const listDiv = document.getElementById('files-list');
      
      container.classList.remove('hidden');
      listDiv.innerHTML = '';
      
      Object.keys(files).forEach(filePath => {
        const fileDiv = document.createElement('div');
        fileDiv.className = 'bg-gray-700 rounded p-3 border border-gray-600';
        
        const headerDiv = document.createElement('div');
        headerDiv.className = 'flex items-center justify-between mb-2';
        headerDiv.innerHTML = `
          <span class="text-sm font-mono text-blue-400">${escapeHtml(filePath)}</span>
          <button onclick="copyToClipboard('${filePath}')" class="text-xs text-gray-400 hover:text-white">
            ðŸ“‹ Copy
          </button>
        `;
        
        const codeDiv = document.createElement('pre');
        codeDiv.className = 'text-xs text-gray-300 overflow-x-auto bg-gray-900 p-2 rounded';
        codeDiv.textContent = files[filePath];
        
        fileDiv.appendChild(headerDiv);
        fileDiv.appendChild(codeDiv);
        listDiv.appendChild(fileDiv);
      });
    }

    function copyToClipboard(filePath) {
      const content = generatedFiles[filePath];
      navigator.clipboard.writeText(content).then(() => {
        alert('Copied to clipboard!');
      });
    }

    function downloadCode() {
      if (!generatedFiles || Object.keys(generatedFiles).length === 0) {
        alert('No files to download');
        return;
      }

      // Create a zip-like structure (simplified - in production, use a proper zip library)
      let zipContent = '';
      Object.keys(generatedFiles).forEach(filePath => {
        zipContent += `=== ${filePath} ===\n${generatedFiles[filePath]}\n\n`;
      });

      const blob = new Blob([zipContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'generated-app-source.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>
